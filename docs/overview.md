# Telegram Manager вЂ” РѕР±Р·РѕСЂ

## РќР°Р·РЅР°С‡РµРЅРёРµ
Р›Р°СѓРЅС‡РµСЂ РґР»СЏ РЅРµСЃРєРѕР»СЊРєРёС… Telegram Portable: РёС‰РµС‚ `Telegram.exe` РІ РїРѕРґРїР°РїРєР°С… СЂР°Р±РѕС‡РµР№ РїР°РїРєРё, Р·Р°РїСѓСЃРєР°РµС‚ РїРѕ Р·Р°РїСЂРѕСЃСѓ Рё РїРѕР·РІРѕР»СЏРµС‚ Р·Р°РєСЂС‹РІР°С‚СЊ РєРѕРЅРєСЂРµС‚РЅС‹Рµ РёР»Рё РІСЃРµ СЌРєР·РµРјРїР»СЏСЂС‹. РџРѕРєР°Р· РЅРѕРјРµСЂРѕРІ РїРѕРІРµСЂС… РѕРєРѕРЅ РїРѕРјРѕРіР°РµС‚ РІС‹Р±СЂР°С‚СЊ РЅСѓР¶РЅС‹Р№ Р°РєРєР°СѓРЅС‚.

## Р‘Р°Р·РѕРІР°СЏ РїР°РїРєР°
- РџСЂРёРѕСЂРёС‚РµС‚ 1: Р°СЂРіСѓРјРµРЅС‚ `-workdir <path>` / `--workdir=<path>`.
- РџСЂРёРѕСЂРёС‚РµС‚ 2: СЃРѕС…СЂР°РЅС‘РЅРЅС‹Р№ РїСѓС‚СЊ `%APPDATA%\TelegramManager\workdir.txt` (СЃРѕС…СЂР°РЅСЏРµС‚СЃСЏ РїСЂРё СѓСЃРїРµС€РЅРѕРј РѕРїСЂРµРґРµР»РµРЅРёРё/РІС‹Р±РѕСЂРµ).
- РџСЂРёРѕСЂРёС‚РµС‚ 3: `Environment.CurrentDirectory` (РЅР°РїСЂРёРјРµСЂ, вЂњР Р°Р±РѕС‡Р°СЏ РїР°РїРєР°вЂќ СЏСЂР»С‹РєР°). Р•СЃР»Рё РѕС‚Р»РёС‡Р°РµС‚СЃСЏ РѕС‚ exe вЂ” СЃРѕС…СЂР°РЅСЏРµС‚СЃСЏ.
- РџСЂРёРѕСЂРёС‚РµС‚ 4: РёРЅС‚РµСЂР°РєС‚РёРІРЅС‹Р№ РІС‹Р±РѕСЂ РїР°РїРєРё (FolderBrowser) РµСЃР»Рё РїСЂРµРґС‹РґСѓС‰РёРµ РІР°СЂРёР°РЅС‚С‹ РЅРµ РїРѕРґРѕС€Р»Рё/СЂР°РІРЅС‹ РїР°РїРєРµ exe.
- Р”Р°Р»РµРµ вЂ” РїР°РїРєР° exe (fallback).

## РўСЂeeРІРѕРµ РјРµРЅСЋ
- В«РћС‚РєСЂС‹С‚СЊ РІСЃРµ Р°РєРєР°СѓРЅС‚С‹В» вЂ” Р·Р°РїСѓСЃРєР°РµС‚ РІСЃРµ РЅР°Р№РґРµРЅРЅС‹Рµ `Telegram.exe` РІ РїРѕРґРїР°РїРєР°С….
- В«РћС‚РєСЂС‹С‚СЊ Р°РєРєР°СѓРЅС‚В» вЂ” РїРѕРґРјРµРЅСЋ, РїРµСЂРµС‡РёСЃР»СЏРµС‚ РїРѕРґРїР°РїРєРё СЃ `Telegram.exe` РїРѕ РёРјРµРЅРё РїР°РїРєРё, Р·Р°РїСѓСЃРє РІС‹Р±СЂР°РЅРЅРѕРіРѕ.
- В«Р—Р°РєСЂС‹С‚СЊ РІС‹Р±СЂР°РЅРЅС‹Р№ Р°РєРєР°СѓРЅС‚В» вЂ” РїРѕРґРјРµРЅСЋ РѕС‚РєСЂС‹С‚С‹С… СЌРєР·РµРјРїР»СЏСЂРѕРІ (РђРєРєР°СѓРЅС‚ 1, 2, вЂ¦), РїСЂРё РЅР°РІРµРґРµРЅРёРё РІС‹РІРѕРґРёС‚ РѕРІРµСЂР»РµРё СЃ РЅРѕРјРµСЂР°РјРё РЅР° РѕРєРЅР°С…; РєР»РёРєРѕРј Р·Р°РєСЂС‹РІР°РµС‚ РІС‹Р±СЂР°РЅРЅС‹Р№.
- В«Р—Р°РєСЂС‹С‚СЊ РІСЃРµ Р°РєРєР°СѓРЅС‚С‹В» вЂ” Р·Р°РєСЂС‹РІР°РµС‚ РІСЃРµ РёР·РІРµСЃС‚РЅС‹Рµ СЌРєР·РµРјРїР»СЏСЂС‹.
- В«Р’С‹С…РѕРґВ» вЂ” СЃРєСЂС‹РІР°РµС‚ С‚СЂРµР№, Р·Р°РєСЂС‹РІР°РµС‚ РёР·РІРµСЃС‚РЅС‹Рµ Telegram Рё Р·Р°РІРµСЂС€Р°РµС‚ РїСЂРёР»РѕР¶РµРЅРёРµ.
- В«РџР°СЂР°РјРµС‚СЂС‹ Р·Р°РїСѓСЃРєР°В» в†’ В«РњР°СЃС€С‚Р°Р± РёРЅС‚РµСЂС„РµР№СЃР°В» вЂ” РІРІРѕРґ Рё СЃРѕС…СЂР°РЅРµРЅРёРµ Р·РЅР°С‡РµРЅРёСЏ РґР»СЏ Р°СЂРіСѓРјРµРЅС‚Р° `-scale` (РїСЂРё Р·Р°РїСѓСЃРєРµ Р°РєРєР°СѓРЅС‚РѕРІ РґРѕР±Р°РІР»СЏРµС‚СЃСЏ, РµСЃР»Рё Р·Р°РґР°РЅРѕ).

## РЁР°Р±Р»РѕРЅС‹
- Р’ СЃРїРёСЃРєРµ РІСЃРµРіРґР° РµСЃС‚СЊ Р±Р°Р·РѕРІС‹Р№ С€Р°Р±Р»РѕРЅ Р±РµР· РєРЅРѕРїРєРё: В«РџСЂРёРјРµС‚, СЃРєРёРЅСЊ РїРѕР¶Р°Р»СѓР№СЃС‚Р° РєР°СЂС‚РѕС‡РєСѓ РєРѕРјРїР°РЅРёРё (РєРѕРјРїР°РЅРёСЏ), РЅРµ РјРѕРіСѓР№ РЅР°Р№С‚РёВ». РќР°Р·РЅР°С‡СЊС‚Рµ РµРјСѓ С…РѕС‚РєРµР№.
- РЈ Р±Р°Р·РѕРІРѕРіРѕ С€Р°Р±Р»РѕРЅР° 200 РїРµСЂРµС„РѕСЂРјСѓР»РёСЂРѕРІРѕРє: РїСЂРё РІСЃС‚Р°РІРєРµ РІС‹Р±РёСЂР°РµС‚СЃСЏ СЃР»СѓС‡Р°Р№РЅС‹Р№ РІР°СЂРёР°РЅС‚. РџРѕРІС‚РѕСЂРЅРѕРµ РЅР°Р¶Р°С‚РёРµ Tab (Р±РµР· Р»РёРјРёС‚Р° РїРѕ РІСЂРµРјРµРЅРё) Р·Р°РјРµРЅСЏРµС‚ С‚РµРєСѓС‰РёР№ С‚РµРєСЃС‚ РЅР° РЅРѕРІС‹Р№ РІР°СЂРёР°РЅС‚; РјРѕР¶РЅРѕ Р¶Р°С‚СЊ Tab СЃРєРѕР»СЊРєРѕ СѓРіРѕРґРЅРѕ, РїРѕРєР° С‚РµРєСЃС‚ РЅРµ РјРµРЅСЏР»СЃСЏ СЂСѓРєР°РјРё.
- РќР°Р·РЅР°С‡Р°Р№С‚Рµ РєР»Р°РІРёС€Рё РІ РјРµРЅСЋ В«РЁР°Р±Р»РѕРЅС‹В». РќР°Р¶Р°С‚РёРµ РІС‹Р±СЂР°РЅРЅРѕР№ РєР»Р°РІРёС€Рё в†’ Tab РІСЃС‚Р°РІР»СЏРµС‚ С‚РµРєСЃС‚ С€Р°Р±Р»РѕРЅР°.

## РћРІРµСЂР»РµРё
- РџСЂРё РЅР°РІРµРґРµРЅРёРё РЅР° В«Р—Р°РєСЂС‹С‚СЊ Р°РєРєР°СѓРЅС‚В» РёР»Рё РїСЂРё РѕС‚РєСЂС‹С‚РёРё РµРіРѕ РїРѕРґРјРµРЅСЋ РїРѕРєР°Р·С‹РІР°СЋС‚СЃСЏ РјРµС‚РєРё СЃ РЅРѕРјРµСЂР°РјРё РЅР° РІРёРґРёРјС‹С… РѕРєРЅР°С… Telegram.
- РЎРєСЂС‹РІР°СЋС‚СЃСЏ РїСЂРё СѓС…РѕРґРµ РєСѓСЂСЃРѕСЂР°/Р·Р°РєСЂС‹С‚РёРё РїРѕРґРјРµРЅСЋ/РІС‹С…РѕРґРµ.

## РђСЂС…РёС‚РµРєС‚СѓСЂР°
- `Program.cs` вЂ” С‚РѕС‡РєР° РІС…РѕРґР°, РїР°СЂСЃРµСЂ `-workdir`, СЃРѕР·РґР°РЅРёРµ `TrayAppContext`.
- `TrayAppContext.cs` вЂ” РјРµРЅСЋ, РѕР±СЂР°Р±РѕС‚РєР° СЃРѕР±С‹С‚РёР№, Р»РѕРіРёРєР° РІС‹Р·РѕРІР° РјРµРЅРµРґР¶РµСЂРѕРІ.
- `TelegramProcessManager.cs` вЂ” РїРѕРёСЃРє `Telegram.exe`, Р·Р°РїСѓСЃРє, С„РёР»СЊС‚СЂР°С†РёСЏ Рё Р·Р°РєСЂС‹С‚РёРµ РїСЂРѕС†РµСЃСЃРѕРІ.
- `OverlayManager.cs`, `WindowOverlay.cs` вЂ” РїРѕРєР°Р·/СЃРєСЂС‹С‚РёРµ РѕРІРµСЂР»РµРµРІ.
- `BaseDirectoryResolver.cs` вЂ” РІС‹Р±РѕСЂ СЂР°Р±РѕС‡РµР№ РїР°РїРєРё.
- `IconFactory.cs` вЂ” Р·РЅР°С‡РѕРє С‚СЂРµСЏ.
- `NativeMethods.cs` вЂ” P/Invoke РґР»СЏ РѕРєРѕРЅРЅС‹С… РєРѕРѕСЂРґРёРЅР°С‚/РІРёРґРёРјРѕСЃС‚Рё.
- Р РµСЃСѓСЂСЃС‹: `assets/telegram-manager.ico` вЂ” Р·РЅР°С‡РѕРє РїСЂРёР»РѕР¶РµРЅРёСЏ/СЏСЂР»С‹РєР° (РїСЂРѕРїРёСЃС‹РІР°РµС‚СЃСЏ РІ csproj).

## РЎР±РѕСЂРєР°
`dotnet build -c Release` (TargetFramework: `net8.0-windows`). РџСЂРµРґСѓРїСЂРµР¶РґРµРЅРёРµ NETSDK1137 Рѕ СЃРјРµРЅРµ SDK РјРѕР¶РЅРѕ РёРіРЅРѕСЂРёСЂРѕРІР°С‚СЊ РёР»Рё РїРѕРјРµРЅСЏС‚СЊ Sdk РЅР° `Microsoft.NET.Sdk`.

## Release
Publish portable self-contained single-file build for Windows so users can run without extra runtimes.

- Profile: Properties/PublishProfiles/Portable.pubxml
- Command: dotnet publish -p:PublishProfile=Portable
- Output: bin/Release/net8.0-windows/win-x64/publish/
- Package: zip the publish folder for distribution

## Notes
Only subfolders that contain a tdata directory are considered valid account folders.

## Обновления приложения
Авто-обновление самой программы проверяет последний GitHub Release по тегу `v*` и скачивает portable-архив.

Настройка через `app_update.json` в папке рядом с exe:

{
  "RepoOwner": "OWNER",
  "RepoName": "REPO",
  "AssetName": "TelegramTrayLauncher-portable-win-x64.zip"
}

- `AssetName` можно не указывать: тогда берётся первый asset с суффиксом `portable-win-x64.zip`.
- После скачивания архив распаковывается во временную папку, файлы копируются в папку запуска, приложение перезапускается.
- После подтверждения обновления показывается отдельное окно со шкалой прогресса (скачивание/подготовка/копирование).
- app_update.json is included in publish output; update RepoOwner/RepoName if the repository changes.

## Версионирование
Версия фиксируется локально в `TelegramTrayLauncher.csproj` (поле `<Version>`). Для релиза тег должен совпадать с этой версией (например, `v1.0.0`).

## Explorer folder context menu
- Added submenu `Telegram Manager` for directory right-click (`HKCU\Software\Classes\Directory\shell\TelegramManager`).
- Commands:
  - `--explorer-add-to-group "<folder>" "<group>"`
  - `--explorer-remove-from-group "<folder>"`
  - `--explorer-create-group-and-add "<folder>"`
  - `--explorer-delete-group "<group>"`
- Account-folder operations validate that folder contains both `Telegram.exe` and `tdata`.
- New modules: `ExplorerContextMenuManager.cs`, `ExplorerGroupCommandHandler.cs`.

## Explorer context menu update
- Removed group deletion action from Explorer menu.
- `Add to group` now includes default groups: `Заморозка` and `Вылеты`.
- Telegram auto-update skips prerelease/draft entries when `VersionUrl` returns a releases array and prefers the latest stable release.
