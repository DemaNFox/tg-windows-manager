# Telegram Manager — обзор

## Назначение
Лаунчер для нескольких Telegram Portable: ищет `Telegram.exe` в подпапках рабочей папки, запускает по запросу и позволяет закрывать конкретные или все экземпляры. Показ номеров поверх окон помогает выбрать нужный аккаунт.

## Базовая папка
- Приоритет 1: аргумент `-workdir <path>` / `--workdir=<path>`.
- Приоритет 2: сохранённый путь `%APPDATA%\TelegramManager\workdir.txt` (сохраняется при успешном определении/выборе).
- Приоритет 3: `Environment.CurrentDirectory` (например, “Рабочая папка” ярлыка). Если отличается от exe — сохраняется.
- Приоритет 4: интерактивный выбор папки (FolderBrowser) если предыдущие варианты не подошли/равны папке exe.
- Далее — папка exe (fallback).

## Трeeвое меню
- «Открыть все аккаунты» — запускает все найденные `Telegram.exe` в подпапках.
- «Открыть аккаунт» — подменю, перечисляет подпапки с `Telegram.exe` по имени папки, запуск выбранного.
- «Закрыть выбранный аккаунт» — подменю открытых экземпляров (Аккаунт 1, 2, …), при наведении выводит оверлеи с номерами на окнах; кликом закрывает выбранный.
- «Закрыть все аккаунты» — закрывает все известные экземпляры.
- «Выход» — скрывает трей, закрывает известные Telegram и завершает приложение.
- «Параметры запуска» → «Масштаб интерфейса» — ввод и сохранение значения для аргумента `-scale` (при запуске аккаунтов добавляется, если задано).

## Шаблоны
- Назначайте клавиши в меню «Шаблоны». Нажатие выбранной клавиши → Tab вставляет текст шаблона.

## Оверлеи
- При наведении на «Закрыть аккаунт» или при открытии его подменю показываются метки с номерами на видимых окнах Telegram.
- Скрываются при уходе курсора/закрытии подменю/выходе.

## Архитектура
- `Program.cs` — точка входа, парсер `-workdir`, создание `TrayAppContext`.
- `TrayAppContext.cs` — меню, обработка событий, логика вызова менеджеров.
- `TelegramProcessManager.cs` — поиск `Telegram.exe`, запуск, фильтрация и закрытие процессов.
- `OverlayManager.cs`, `WindowOverlay.cs` — показ/скрытие оверлеев.
- `BaseDirectoryResolver.cs` — выбор рабочей папки.
- `IconFactory.cs` — значок трея.
- `NativeMethods.cs` — P/Invoke для оконных координат/видимости.
- Ресурсы: `assets/telegram-manager.ico` — значок приложения/ярлыка (прописывается в csproj).

## Сборка
`dotnet build -c Release` (TargetFramework: `net8.0-windows`). Предупреждение NETSDK1137 о смене SDK можно игнорировать или поменять Sdk на `Microsoft.NET.Sdk`.
